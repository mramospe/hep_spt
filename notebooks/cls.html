
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CLs method &#8212; hep_spt 0.0.0.dev1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.0.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Adaptive binning" href="adbin.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="CLs-method">
<h1>CLs method<a class="headerlink" href="#CLs-method" title="Permalink to this headline">¶</a></h1>
<p>The hep_spt package also provides tools to work with the CLs method.
This method is oftenly used in High Energy Physics to reject models,
preventing the exclusion when there is not enough statistical power. The
rejection is determined comparing an alternative model, with repect to
the null model. In this document you can see an example of how to work
with the different classes and functions here present.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">poisson</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">norm</span>
</pre></div>
</div>
</div>
<div class="section" id="The-CLs-test-statistics">
<h2>The CLs test statistics<a class="headerlink" href="#The-CLs-test-statistics" title="Permalink to this headline">¶</a></h2>
<p>Here we are going to create four different models (related two by two).
The first two will follow a poissonian distribution, while the other two
will be gaussians. Note that we can only work with only one type o
functions, i.e. either both models follow a discrete or a continuous
function. We will then plot the distributions of the null and
alternative hypotheses, together with their associated test-statistics.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">hep_spt</span>
<span class="n">hep_spt</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;multiplot&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">axs0</span><span class="p">,</span> <span class="n">axs1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">axs0</span><span class="p">,</span> <span class="n">axs1</span><span class="p">)):</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">alt</span>  <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_hypo</span><span class="p">(</span><span class="n">poisson</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">null</span> <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_hypo</span><span class="p">(</span><span class="n">poisson</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alt</span>  <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_hypo</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">null</span> <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_hypo</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">a_smp</span> <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">rv_random_sample</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
    <span class="n">n_smp</span> <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">rv_random_sample</span><span class="p">(</span><span class="n">null</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>

    <span class="n">cls_mgr</span> <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_ts</span><span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="n">null</span><span class="p">)</span>

    <span class="c1"># Plot the line referring to the percentiles</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">n_smp</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Null hypothesis&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">a_smp</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Alternative hypothesis&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;a.u.&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Plot the test-statistics for the two hypotheses</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cls_mgr</span><span class="o">.</span><span class="n">test_stat</span><span class="p">(</span><span class="n">n_smp</span><span class="p">),</span> <span class="mi">40</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Null hypothesis&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cls_mgr</span><span class="o">.</span><span class="n">test_stat</span><span class="p">(</span><span class="n">a_smp</span><span class="p">),</span> <span class="mi">40</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Alternative hypothesis&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Test statistics value&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cls_3_0.png" src="../_images/notebooks_cls_3_0.png" />
</div>
</div>
</div>
<div class="section" id="Running-a-CLs-scan">
<h2>Running a CLs scan<a class="headerlink" href="#Running-a-CLs-scan" title="Permalink to this headline">¶</a></h2>
<p>Oftenly, we have a model that depends on a certain parameter, which we
use to determine the rejection. In this case we will assume that we are
looking for a signal on a sample, which can only be explained by an
alternative model (so our expectation is full-background). Our parameter
for the scan will be the effect of our new model (the number of entries
over the background). The value of this effect might vary in the
alternative model, thus we can use the CLs method to reduce the allowed
value-space for it. We will consider that we have three bins, which
might be related, for example, to different independent samples with
tighter cuts in each of them.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span> <span class="k">as</span> <span class="n">odict</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">ScalarFormatter</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">lines</span>
<span class="n">hep_spt</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;singleplot&#39;</span><span class="p">)</span>

<span class="c1"># Define the background, the effect of the alternative model and the observation</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">25.</span><span class="p">,</span> <span class="mf">16.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">])</span>
<span class="n">eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">29.</span><span class="p">,</span> <span class="mf">13.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">])</span>

<span class="n">dct</span> <span class="o">=</span> <span class="n">odict</span><span class="p">([(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mi">10</span><span class="p">))])</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y1sl&#39;</span><span class="p">,</span> <span class="s1">&#39;y1sr&#39;</span><span class="p">,</span> <span class="s1">&#39;y2sl&#39;</span><span class="p">,</span> <span class="s1">&#39;y2sr&#39;</span><span class="p">,</span> <span class="s1">&#39;yobs&#39;</span><span class="p">):</span>
    <span class="n">dct</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># 1 and 2 sigma intervals</span>
<span class="n">sig1</span> <span class="o">=</span> <span class="n">chi2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sig2</span> <span class="o">=</span> <span class="n">chi2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">null</span> <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_hypo</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">bkg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bkg</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">eff</span> <span class="o">+</span> <span class="n">bkg</span>
    <span class="n">alt</span>  <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_hypo</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="n">cls_mgr</span> <span class="o">=</span> <span class="n">hep_spt</span><span class="o">.</span><span class="n">cls_ts</span><span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="n">null</span><span class="p">)</span>

    <span class="c1"># This way we calculate all the values at once, using the same sample</span>
    <span class="c1"># for the test-statistics for each hypothesis</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">cls_mgr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">null</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
            <span class="n">null</span><span class="o">.</span><span class="n">percentil</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">sig1</span><span class="p">),</span>
            <span class="n">null</span><span class="o">.</span><span class="n">percentil</span><span class="p">(</span><span class="n">sig1</span><span class="p">),</span>
            <span class="n">null</span><span class="o">.</span><span class="n">percentil</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">sig2</span><span class="p">),</span>
            <span class="n">null</span><span class="o">.</span><span class="n">percentil</span><span class="p">(</span><span class="n">sig2</span><span class="p">),</span>
            <span class="n">obs</span>
        <span class="p">]),</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">)</span>

    <span class="c1"># First item in &quot;dct&quot; is &quot;x&quot;</span>
    <span class="k">for</span> <span class="n">dv</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dct</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">values</span><span class="o">.</span><span class="n">CLs</span><span class="p">):</span>
        <span class="n">dv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="c1"># Plot the predicted and observed CLs lines, together with the 1 and 2 sigma regions</span>
<span class="n">r2s_area</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;y2sl&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;y2sr&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
<span class="n">r1s_area</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;y1sl&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;y1sr&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">pre_line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">obs_line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;yobs&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Add the 90% and 95% CL lines</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">()</span>

<span class="n">x90</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;yobs&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)(</span><span class="mf">0.10</span><span class="p">)</span>
<span class="n">x95</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;yobs&#39;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)(</span><span class="mf">0.05</span><span class="p">)</span>

<span class="n">line_90</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">x90</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">line_95</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">x95</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">((</span><span class="n">x90</span><span class="p">,</span> <span class="n">x90</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">((</span><span class="n">x95</span><span class="p">,</span> <span class="n">x95</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># Change the scale settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;CLs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Scan variable&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
    <span class="p">(</span><span class="n">pre_line</span><span class="p">,</span> <span class="s1">&#39;Predicted limit&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">obs_line</span><span class="p">,</span> <span class="s1">&#39;Observed limit&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">r1s_area</span><span class="p">,</span> <span class="s1">&#39;$1\sigma$ region&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">r2s_area</span><span class="p">,</span> <span class="s1">&#39;$2\sigma$ region&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">line_90</span> <span class="p">,</span> <span class="s1">&#39;90\% CL&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">line_95</span> <span class="p">,</span> <span class="s1">&#39;95\% CL&#39;</span><span class="p">)</span>
<span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Limits:</span><span class="se">\n</span><span class="s1">- 90% CL: </span><span class="si">{:.4f}</span><span class="se">\n</span><span class="s1">- 95% CL: </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x90</span><span class="p">,</span> <span class="n">x95</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Limits:
- 90% CL: 2.3141
- 95% CL: 2.8030
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cls_5_1.png" src="../_images/notebooks_cls_5_1.png" />
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">hep_spt</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../main.html">Functions and classes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="stats.html">Statistical tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html#Plotting-efficiencies">Plotting efficiencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="adbin.html">Adaptive binning</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">CLs method</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../examples.html">Examples</a><ul>
      <li>Previous: <a href="adbin.html" title="previous chapter">Adaptive binning</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Miguel Ramos Pernas.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/notebooks/cls.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>